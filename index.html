<html>
<body>

provider "aws" {
	profile ="Asish"
	region ="ap-south-1"
}



resource "aws_key_pair" "key_task" {
  key_name   = "key_task"
  public_key = "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQD3F6tyPEFEzV0LX3X8BsXdMsQz1x2cEikKDEY0aIj41qgxMCP/iteneqXSIFZBp5vizPvaoIR3Um9xK7PGoW8giupGn+EPuxIA4cDM4vzOqOkiMPhz5XK0whEjkVzTo4+S0puvDZuwIsdiW9mxhJc7tgBNL0cYlWSYVkz4G/fslNfRPW5mYAM49f4fhtxPb5ok4Q2Lg9dPKVHO/Bgeu5woMc7RY0p1ej6D4CKFE6lymSDJpW0YHX/wqE9+cfEauh7xZcG0q9t2ta6F6fmX0agvpFyZo8aFbXeUBr7osSCJNgvavWbM/06niWrOvYX2xwWdhXmXSrbX8ZbabVohBK41 asishpatnaik2000@gmail.com"
}



resource "aws_security_group" "task1_securitygrp" {
  name        = "task1_securitygrp"
  description = "Allow TLS inbound traffic"
  vpc_id      = "vpc-df9489b7"

   ingress {
    description = "TLS from VPC"
    from_port   = 443
    to_port     = 443
    protocol    = "tcp"
     cidr_blocks = ["0.0.0.0/0"]
  }


 ingress{
    description = "SSH"
     from_port =22
     to_port=22
      protocol ="tcp"
       cidr_blocks = ["0.0.0.0/0"]
}


ingress{
    description = "HTTP"
     from_port=80
      to_port=80
       protocol = "tcp"
       cidr_blocks = ["0.0.0.0/0"]
    }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = {
    Name = "task1_securitygrp"
  }
}


resource "aws_ebs_volume"  "task1_storage" {
  size              = 1
availability_zone = "ap-south-1a"
  type              = "gp2"
  tags={
	Name= "task1_storage"
          }
}

resource "aws_volume_attachment" "task1_storage_att" {
  device_name = "/dev/xvdf"
 volume_id   = "${aws_ebs_volume.task1_storage.id}"
  instance_id = "${aws_instance.task1os.id}"
}


resource "aws_instance"  "task1os" {
  ami           = "ami-005956c5f0f757d37"
  instance_type = "t2.micro"
     availability_zone= "ap-south-1a"
 key_name= "key_task"
 security_groups= ["task1_securitygrp"]

user_data=<<-EOF
		#!/bin/bash
		sudo yum install httpd -y
		sudo systemctl start httpd
		sudo systemctl enable httpd
		sudo yum install git -y
		mkfs.ex14 /dev/xvdf1 /var/www/html
		cd /var/www/html
		git clone https://github.com/Pheonix-reaper/Task1_cloud.git
		
	EOF

  tags = {
    Name = "task10s"
  }
}


output  "myoutaz" {
	value = aws_instance.task1os.availability_zone
}


output "myop1"{
	value=aws_instance.task1os.id
}




output "myop2"{
	value=aws_ebs_volume.task1_storage.id
}







</body>
</html>
